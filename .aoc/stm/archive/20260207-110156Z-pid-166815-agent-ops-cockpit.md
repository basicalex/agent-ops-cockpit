- [2026-02-07 12:01] AOC Pulse pane/context for this session: We diagnosed ghost agents showing in Pulse (more OpenCode runtimes than active zellij panes). Root cause was dual: (1) wrapper teardown not reliably running on normal child exit, and (2) runtime ingestion trusted stale telemetry/PID existence without pane topology validation. Changes made: bin/aoc-agent-wrap now runs cleanup_pane_agents after wrapped command returns and excludes wrapper PID in kill scan to avoid self-termination races. crates/aoc-mission-control/src/main.rs now filters runtime snapshots to active pane-ids from zellij dump-layout and only marks runtime online when /proc env matches session+pane identity; identity key normalized to session::pane. aoc-cleanup was hardened to use AOC_SESSION_ID/AOC_PANE_ID (fallback ZELLIJ vars), build active pane map from dump-layout, kill tagged processes whose pane no longer exists, restrict cwd heuristics to untagged processes, and prune stale telemetry snapshots. Interactive cleanup UX now split into scope then action (dry-run recommended), with explicit live confirmation; CLI supports --dry-run/--execute. Validation run in-session: bash -n bin/aoc-agent-wrap OK, cargo check -p aoc-mission-control OK, bash -n bin/aoc-cleanup OK, embedded python compile OK, dry-run smoke test shows deterministic would-kill/would-prune output.
