- [2026-02-21 12:36] [2026-02-21] Handoff: Resolved AOC context injection architecture gap. Root cause found in bin/aoc-agent-wrap handshake: context.md was truncated to head -n 50, memory used tail -n 20, and STM archives were referenced but not injected.
- [2026-02-21 12:36] Implemented baseline contract update in AGENTS.md and aoc-init: command-first guidance for aoc-stm/aoc-mem/tm via Bash (no skill required), explicit do-not-read-direct-files rule, and retained task PRD linking guidance via aocPrd + aoc-task prd show <id>.
- [2026-02-21 12:36] Implemented migration-safe AGENTS management in bin/aoc-init: ensure_agents_contract + write_aoc_agents_contract. Existing AOC-style AGENTS are upgraded to latest contract on next aoc-init; non-AOC AGENTS are preserved and appended with AOC section.
- [2026-02-21 12:36] Refactored context generation in bin/aoc-init to project-only compact snapshot (repo facts, key files, tree, README headings, active tags, PRD location) with configurable budgets: AOC_CONTEXT_LINE_BUDGET, AOC_CONTEXT_TREE_DEPTH, AOC_CONTEXT_TREE_LINE_BUDGET, AOC_CONTEXT_README_HEADING_LIMIT. Added numeric guards via positive_int_or_default.
- [2026-02-21 12:36] Updated bin/aoc-agent-wrap handshake to inject full .aoc/context.md (cat) instead of head truncation. Updated docs in README.md and docs/configuration.md to reflect project-specific compact context model.
- [2026-02-21 12:36] Validation completed: bash -n on modified scripts; smoke aoc-init runs on temp repos for both legacy-AOC AGENTS migration and non-AOC append behavior; no syntax/runtime errors observed in smoke outputs.
- [2026-02-21 12:36] Created RTK foundation artifacts: PRD .taskmaster/docs/prds/aoc-rtk_prd_rpg.md (agent-agnostic, fail-open, Alt+C integration, migration plan). Added task tag rtk and tasks: 86 adapter baseline, 87 runtime routing, 88 aoc-control setup UX, 89 aoc-init migration defaults, 90 docs/rollout. Linked PRD to task 86 via tm prd set --tag rtk 86 ...
- [2026-02-21 12:36] RTK strategy agreed: upstream-first adapter (no fork initially), pinned release + checksum verification, avoid runtime latest pulls, session-level integration through aoc-agent-wrap so all agents (codex/gemini/kimi/cc/oc) share behavior, with explicit bypass and fail-open fallback.
- [2026-02-21 12:36] Next build execution order: (1) implement aoc-rtk command contract + config schema, (2) implement aoc-rtk-proxy and PATH/session wiring in aoc-agent-wrap, (3) add Alt+C aoc-control RTK actions/status, (4) extend aoc-init migration + docs + test matrix across all supported agent wrappers.
