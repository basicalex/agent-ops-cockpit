- [2026-02-07 12:24] Objective: Audit and harden AOC Pulse/agent lifecycle around pane close behavior; verify opencode processes do not hang in background; provide UX/DX critique and implementation fixes.
- [2026-02-07 12:24] Done: Audited live session vs process table. Found real orphan leak path when pane closed/reused: cleanup keyed primarily on session+pane_id could miss stale trees and was vulnerable to pane-id reuse collisions.
- [2026-02-07 12:24] Done: Implemented wrapper instance-leasing and lease-aware cleanup in bin/aoc-agent-wrap. Added AOC_PANE_INSTANCE_ID + AOC_PANE_LEASE_FILE, startup conflict reap, watchdog lease ownership checks, and self-only cleanup targeting.
- [2026-02-07 12:24] Done: Updated bin/aoc-cleanup to treat lease mismatch as orphan candidate (even if pane_id appears active), improving stale detection when pane ids are reused.
- [2026-02-07 12:24] Validation: bash -n passed for bin/aoc-agent-wrap and bin/aoc-cleanup. Process audits showed orphan pane-27 chain before fix and clean state after cleanup execution.
- [2026-02-07 12:24] Incident note: During manual proof cleanup, one live Honk chain was terminated. User stated Honk tab continuity is not important; priority is robust Pulse/agent lifecycle handling.
- [2026-02-07 12:24] Pulse functionality map (high-level): Pulse UI (aoc-mission-control) consumes hub events (agent_status/task_summary/diff_summary/heartbeat) with local fallback collectors (runtime snapshots/tasks.json/git). Hub emits synthetic offline on last publisher disconnect. Wrapper publishes telemetry and runtime snapshots.
- [2026-02-07 12:24] UX critique (Pulse): strong resilience via hub+runtime fallback; weak discoverability in compact pane; narrow default right-pane width constrains readability; monitor-first UX lacks deep drill-in actions; docs drift exists between widget-era docs and Pulse behavior in some pages.
- [2026-02-07 12:24] DX critique (Pulse): solid session::pane identity model; maintainability risk from large monolithic mission-control source; duplicated session/port/env/git logic across shell+rust components; some cleanup/lifecycle complexity distributed across scripts raises regression risk without focused lifecycle tests.
- [2026-02-07 12:24] Files changed in this work: bin/aoc-agent-wrap, bin/aoc-cleanup (uncommitted).
- [2026-02-07 12:24] Open decisions: (1) whether to add strict no-live-pane-kill guard by default in aoc-cleanup execute mode; (2) whether to add regression tests/smoke harness for pane-close/pane-id-reuse/orphan scenarios; (3) whether to refactor Pulse lifecycle logic into smaller modules.
- [2026-02-07 12:24] Next steps (recommended): 1) restart agent panes so new lease env is active in all chains; 2) run AOC_CLEANUP_INTERACTIVE=0 aoc-cleanup --dry-run and verify zero orphans; 3) add scripted regression checks for pane close + pane-id reuse; 4) align docs (README/configuration/mission-control-ops) with current Pulse architecture.
