- [2026-02-13 11:19] Objective + scope:
- Prepare a clean handoff so next session can start fresh while preserving exact status.

Done:
- Implemented project-shared layouts support (.aoc/layouts) across launch flow and picker tools.
- Updated layout precedence to prefer project layout names over global ~/.config/zellij/layouts.
- Updated docs and aoc-ops guidance for custom project layouts.
- Fixed stale STM command guidance: /stm now instructs archive/read flow, not legacy tab-launch flow.
- Improved aoc-stm deprecated `use` messaging with better error hints for missing archive names.

In progress:
- Investigating intermittent issue where `aoc` starts but agent exits immediately.

Key evidence:
- `~/.local/state/aoc/cleanup.log` repeatedly shows: "No active agent panes discovered; falling back to safe-pid logic only" then kills opencode processes.
- aoc-launch/aoc-new-tab currently start `aoc-cleanup` in background at launch time, which can race with fresh pane startup.

Likely root cause:
- Launch-time cleanup race condition misclassifies newly-starting agent processes as orphaned before pane signals are visible.

Files touched (this session):
- bin/aoc-layout
- bin/aoc-launch
- bin/aoc-new-tab
- crates/aoc-control/src/main.rs
- bin/aoc-init
- bin/aoc-stm
- docs/layouts.md
- docs/configuration.md
- README.md
- AOC.md
- AGENTS.md
- docs/agents.md
- .aoc/agents/opencode/aoc-ops.md
- .opencode/agents/aoc-ops.md
- .opencode/commands/stm.md
- .gitignore

Last command outcomes:
- Shell syntax checks passed for updated scripts.
- `cargo check --manifest-path crates/Cargo.toml -p aoc-control` passed.
- `bin/aoc-stm use <archive>` now prints deprecation + actionable guidance.

Open decisions / assumptions:
- Keep cleanup feature enabled, but add startup-safe guardrails instead of removing it entirely.

Next 5 concrete steps:
1) Add launch guard so cleanup cannot kill agent processes created during a configurable startup grace period.
2) Scope cleanup to current session by default when launched from aoc-launch/aoc-new-tab.
3) Require positive pane/session signal before any kill in fallback mode (or downgrade fallback to dry-run at launch).
4) Add regression checks for "fresh launch" and "no active panes yet" cases.
5) Re-run launch smoke tests and verify cleanup.log shows no live-agent kills during startup.
