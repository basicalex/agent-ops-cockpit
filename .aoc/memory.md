# Agent Memory for Project: agent-ops-cockpit
This file contains persistent context, decisions, and knowledge for the AI agent.
Agents should read this to understand project history and append new decisions here.

## Core Decisions
- [2026-01-11 21:00] Implemented native Gemini support in Zellij (bypassed tmux) to fix redraw issues.
- [2026-01-11 21:02] Integrated Claude Code, Gemini, and OpenCode shims with tmux-backed scrollback support (except Gemini).
- [2026-01-11 21:02] Fixed infinite recursion in aoc-agent-wrap by adding robust is_wrapper and path resolution logic.
- [2026-01-11 21:02] Modified aoc-gemini/cc/oc to use AOC_AGENT_ID directly for new tabs to avoid overriding global user defaults.
- [2026-01-11 21:02] Created aoc-mem tool for project-local, markdown-based long-term memory in .gemini/memory.md.
- [2026-01-12 14:59] Taskmaster plugin now resolves root via the shared project_root file (and only falls back to env), so new tabs don't inherit stale AOC_PROJECT_ROOT.
- [2026-01-14 09:58] Taskmaster plugin: aoc-new-tab now creates a unique per-tab project_root file (mktemp) and plugin render throttles based on data changes to avoid scrollback growth; tasks.json parsing accepts numeric IDs.
- [2026-01-14 10:31] Per-tab root/star isolation: aoc-launch and aoc-new-tab now create sanitized tab+timestamp root/star files, inject root_file into per-tab temp layouts, and plugin reads root file directly; cleanup removes state files older than 30 days.
- [2026-01-15 22:35] Added aoc-session-watch idle watcher: sessions named aoc-<tag> rename to idle-<tag> on detach, prune non-agent processes by session pid, and auto-resurrect by opening a new full layout tab on reattach. aoc-launch now starts watcher and names sessions; aoc-new-tab realigns current pane to per-tab root; aoc-star uses per-tab AOC_STAR_FILE.
- [2026-01-17 09:15] Fixed per-tab root isolation: layout templates now use __AOC_PROJECT_ROOT_FILE__ placeholders that get replaced at layout generation; aoc-align and aoc-star now derive per-tab root files from session name (aoc-<root_tag> pattern).
- [2026-01-17 10:08] Fixed per-tab root discovery: aoc-align and aoc-star now discover root_tag from pane names (name="aoc:<root_tag>") via dump-layout instead of session name, enabling multi-tab sessions with different project roots per tab.
- [2026-01-17 10:08] Fixed aoc-launch session creation: now uses --new-session-with-layout flag (Zellij 0.43+) to always create new sessions instead of attempting to attach to non-existent sessions.
- [2026-01-17 10:08] Fixed Taskmaster plugin write-back: replaced non-existent exec_cmd() calls with run_command_with_env_variables_and_cwd() so status changes via TUI actually persist to tasks.json.
- [2026-01-17 10:08] KNOWN ISSUE: Orphaned opencode processes accumulate (14 sessions using 18GB RAM observed). Session/pane cleanup needs optimization - aoc-session-watch may not be killing processes properly on tab close.
- [2026-01-17 17:52] Per-tab root isolation v2: yazi pane now has name="aoc:<root_tag>" attribute; aoc-align and aoc-star use dump-layout to discover root_tag from pane names in current tab (not session name), enabling multi-tab sessions with different project roots.
- [2026-01-17 18:23] Refined Zellij layouts to use explicit placeholder injection (__AOC_PROJECT_ROOT_FILE__, __AOC_STAR_FILE__) for robust per-tab environment isolation, solving the limitation of Zellij not propagating env vars to new tabs.
- [2026-01-17 18:30] Fixed Taskmaster plugin scrollback growth and redundant rendering. Implemented render throttling (cache check) and cursor homing (ANSI Home) in the plugin render loop. Optimized state updates to avoid marking dirty on identical data reads.
- [2026-01-17 18:40] Refactored aoc-session-watch to strictly enforce 'Kill on Detach'. Sessions are now immediately deleted when the client disconnects, solving the memory leak issue caused by zombie agent processes.
- [2026-01-17 18:47] Created aoc-cleanup utility to identify and kill orphaned agent processes (zombies) that are not descendants of any active Zellij session.
- [2026-01-17 18:52] Hardened Tmux configuration (codex-tmux.conf) with 'destroy-unattached on' and 'exit-empty on' to ensure agent sessions self-destruct when Zellij panes close. Reduced history-limit to 10k to conserve RAM.
- [2026-01-17 20:10] Switched default editor to `micro` to improve developer UX and prevent terminal glitching caused by Vim/Neovim modal confusion. Implemented enforcement via `EDITOR` in `.bashrc`, wrapper script `bin/tm-editor`, and explicit environment injection in Zellij layout (`aoc.kdl`).
- [2026-01-17 20:30] Hardened `aoc-session-watch` with safety timeouts and consecutive idle requirements (3x) to prevent premature session termination during slow Zellij responses.
- [2026-01-17 20:30] Updated `aoc-cleanup` with a protected whitelist for cockpit helper scripts and more specific agent process regex to prevent accidental termination of active session management components.
- [2026-01-17 21:23] Implemented RLM (Recursive Language Model) skill: created bin/aoc-rlm for context slicing and updated aoc-init to inject RLM protocol into project context.
- [2026-01-17 21:40] Architecture Gap Analysis: Identified four key operational gaps: 1) Context Lifecycle is static (needs reactive watcher), 2) Agent attribution is boolean (needs ID-based tracking), 3) Doctor validation is existence-only (needs version comparison), and 4) Handshake is startup-only (needs live sync). Created tasks #30-#33 to track these gaps.
- [2026-01-18 11:13] Implemented Reactive Context Watcher (aoc-watcher) in Rust. It uses Zellij dump-layout to discover per-tab project roots (via name='aoc:<root_tag>' anchors) and monitors them with notify. Integrated into aoc-launch; logs to watcher.log.
- [2026-01-20 14:37] Updated aoc-agent-wrap to auto-resolve opencode binaries from PNPM global installs (opencode-ai/opencode) to avoid wrapper recursion; handshake now prefers nearest .aoc from PWD or repo root.
- [2026-01-20 14:42] Pinned OpenCode to version 1.1.25 via AOC_OC_VERSION default in wrappers; aoc-agent-wrap now prefers pinned version when resolving PNPM opencode binaries.
- [2026-01-25 10:10] Never use project_root state files for variable injection or context; avoid passing runtime state via project_root.* files.
- [2026-01-26 00:00] Docs clarified: root discovery is anchored on Agent pane (Agent [<root_tag>]) and per-tab project_root files; Yazi pane titles can be dynamic without affecting root tagging.
- [2026-01-27 17:23] Added ROADMAP.md documenting cross-platform vision: multi-shell terminal support (Phase 1), script portability (Phase 2), alternative multiplexer research (Phase 3), and native Windows (Phase 4, blocked by Zellij). Created task #41 for multi-shell implementation with 6 subtasks.
- [2026-01-27 17:45] Started Phase 2: Custom Layout Selection (Task #42). Allows users to select, persist, and use custom layouts with generic context injection. Bumped Script Portability to Phase 3.
- [2026-01-27 17:48] Completed Phase 2: Custom Layout Selection. Implemented bin/aoc-layout, updated bin/aoc-new-tab and bin/aoc-launch to support persistent, generic layout selection with context injection.
- [2026-01-27 18:08] Documented Custom Layouts feature in docs/layouts.md. Added minimal.kdl layout template and updated install.sh to deploy it. Updated README and AOC.md with links.
- [2026-01-27 19:44] Added Resonance non-canonical Logseq layer docs/prompts and a promotion queue TUI (tools/resonance-promoter) with configurable auto-promote; Obsidian remains canonical.
- [2026-01-28 16:09] Planned architecture shift: deprecate Rust Zellij Taskmaster plugin in favor of Go-native Bubble Tea Taskmaster, plus a session-scoped WS hub, agent-agnostic Go wrapper streaming status/diff summaries, and a Mission Control TUI with diff views and editor integration.
- [2026-01-28 17:08] Documented Mission Control architecture and message schema in docs/mission-control.md, including session scoping, envelope fields, message types, diff summary/patch handling, error semantics, and port derivation.
- [2026-01-28 17:49] Implemented Go-based aoc-hub websocket server (cmd/aoc-hub) with handshake validation, session isolation, state caching, snapshot on subscribe, routing for diff patch requests, and ping/stale cleanup; added Go module deps for hub.
- [2026-01-28 18:03] Implemented Go aoc-agent-wrap-go wrapper to launch agent commands, connect to hub with reconnection, stream agent_status, diff_summary, task_summary, heartbeat, and respond to diff_patch_request; added fsnotify task watching and git diff summary handling with logging.
- [2026-01-28 20:35] Removed Go Mission Control binaries and added Rust crates: aoc-hub-rs, aoc-agent-wrap-rs, aoc-mission-control (initial hub/wrapper/TUI scaffolds).
- [2026-01-28 21:17] Rust-only directive: treat prior Go Mission Control/hub/wrapper references as obsolete history; current and future implementation is Rust-only (aoc-hub-rs, aoc-agent-wrap-rs, aoc-taskmaster, aoc-mission-control).
- [2026-01-28 21:33] Added native aoc-taskmaster Ratatui TUI crate with direct filesystem access; plugin remains in place for now.
- [2026-01-29 20:49] Paused Mission Control Alt+a fix; Alt+a unbound in zellij/aoc.config.kdl. Suspected issue: Zellij Run keybind opens a split pane; toggle script closes focused pane, so MC blinks and split remains. Resume by verifying Zellij 0.43.1 keybind options (Run/NewPane close_on_exit/floating) and prefer keybind-only fix; otherwise adjust aoc-mission-control-toggle close logic.
- [2026-01-29 20:54] aoc-taskmaster root resolution now prefers walking up from cwd before AOC_PROJECT_ROOT to avoid stale session env in new tabs.
- [2026-01-30 17:19] Added Kimi agent support with aoc-kimi and kimi shim (AOC_KIMI_BIN override) for agent selection.
- [2026-01-31 10:09] Floating TUI panes in Zellij: use keybind Run with floating true + close_on_exit true (not NewPane), e.g. Run "bash" "-lc" "AOC_CONTROL_NO_FLOAT=1 AOC_CONTROL_FLOATING_ACTIVE=1 exec aoc-control" { floating true close_on_exit true }. Avoids split panes and blinking.
- [2026-01-31 14:47] OSS readiness: ignore .aoc and .taskmaster in git, untrack local state; template zellij/aoc.config.kdl with HOME replacement; remove hard-coded aoc-pane-rename paths; add WSL README section and CODE_OF_CONDUCT.md.
- [2026-02-02 11:33] Pinned globset to 0.4.17 and regenerated crates/Cargo.lock with Cargo 1.75 (lockfile v3) to avoid edition2024/lockfile v4 failures on stable toolchains.
- [2026-02-04 13:37] Yazi smart open now opens media via system default app; widget set moved to W (y restored to yank).
- [2026-02-04 14:15] Widget state now persists per project (media path + render settings). If no project media is set, widget defaults to gallery with global defaults as fallback.
- [2026-02-04 19:33] Widget state now splits: per-project media asset + media render settings keyed by git remote (relative paths when inside repo); gallery settings remain global; widget adds G to save global defaults and R to reset.
- [2026-02-06 08:27] Mission-control planning: top-right Widget+Clock should be replaced by a single AOC Pulse pane with v1 introspection fallback and v2 hub-backed telemetry; identities must be normalized to session_id+pane_id to prevent cross-tab collisions. Documented under task 49 (mission-control).
- [2026-02-06 09:11] Implemented task-level PRD linkage via Task.aocPrd with external docs under .taskmaster/docs/prds; added aoc-task prd show/set/clear/init commands, subtask PRD validation guardrails, Taskmaster PRD visibility, and updated AGENTS/skills/handshake guidance to require reading linked PRDs before implementation.
- [2026-02-06 11:37] AOC Pulse now replaces Widget+Clock in default aoc layout with hub-preferred (agent_status/task_summary/diff_summary/heartbeat) and local fallback collectors; telemetry identity normalized to session_id::pane_id with agent labels as metadata only.
- [2026-02-07 09:51] AOC Pulse now applies hub envelope timestamps as event_at when updating hub cache so stale snapshot entries are pruned immediately instead of appearing as fresh agents.
- [2026-02-07 10:01] Hub now emits synthetic offline agent_status and clears cached state when the last publisher disconnects; aoc-agent-wrap now enables pane cleanup for all agents and kills all same-pane/session processes on tab teardown.
- [2026-02-07 10:16] Hub ping loop now only refreshes last_seen for subscribers; publisher liveness is based on inbound messages so closed agent sockets are reaped faster instead of being kept fresh by outbound pings.
- [2026-02-07 10:26] Pulse overview now merges hub rows with local process/runtime rows when hub is connected, and hub cache prunes agents missing from local-online identities after a short grace to avoid long red linger for closed panes.
- [2026-02-07 10:32] aoc-agent-wrap watchdog now polls zellij dump-layout for pane-id presence; if pane disappears (even if wrapper shell survives), it kills all same-session same-pane processes including parent wrapper to prevent ghost agents in Pulse.
- [2026-02-07 10:42] 2026-02-07: Hardened aoc-agent-wrap watchdog for non-codex agents by removing pane-existence string-match checks against zellij dump-layout; watchdog now waits for wrapper parent death before cleaning pane-scoped agent processes to avoid spontaneous opencode exits.
- [2026-02-07 11:27] 2026-02-07: Fixed pane teardown ghosting by forcing aoc-agent-wrap cleanup on normal child exit and excluding wrapper PID from pane kill scan; AOC Pulse runtime collector now filters telemetry to active zellij pane-ids and validates /proc env session+pane match to avoid stale PID reuse showing ghost agents.
- [2026-02-07 11:52] 2026-02-07: Reworked aoc-cleanup to prioritize AOC session/pane identity. It now maps active pane IDs from zellij dump-layout, reads AOC_SESSION_ID/AOC_PANE_ID from /proc env, kills tagged agents whose pane is no longer active, limits cwd-based keep heuristics to untagged processes, and prunes stale runtime telemetry snapshots after cleanup.
- [2026-02-07 11:54] 2026-02-07: Added aoc-cleanup dry-run mode (--dry-run / AOC_CLEANUP_DRY_RUN=1) with explicit 'would kill' and 'would prune' output, plus --execute override and --help usage text. Runtime snapshot pruning now runs even when no orphan processes are found.
- [2026-02-07 11:59] 2026-02-07: Hardened aoc-cleanup interactive UX: split selection into scope + action, default action prompts with dry-run recommended, require explicit confirmation before live execution, and print resolved setup (scope/mode) before analysis.
- [2026-02-07 12:25] [2026-02-07] Hardened agent lifecycle cleanup by introducing per-wrapper pane instance leases (AOC_PANE_INSTANCE_ID + lease file) in bin/aoc-agent-wrap and lease-aware orphan detection in bin/aoc-cleanup to mitigate pane-id reuse collisions and stale background opencode trees.
- [2026-02-07 21:28] 2026-02-07: Created new Taskmaster tag pulse-hub-spoke with tasks 62-69 and PRD linked to task 62 for Pulse vNext architecture: passive UDS hub + active wrapper transparent tap, no hub dump-screen scraping, fast dump-layout watcher for pane lifecycle, and wrapper-owned command/SIGINT control path.
- [2026-02-07 21:38] 2026-02-07: Added shared Pulse IPC module in aoc-core (crates/aoc-core/src/pulse_ipc.rs) with typed WireMsg variants (hello/subscribe/snapshot/delta/heartbeat/command/command_result), NDJSON framing helpers with max-size guards + malformed-line recovery, and protocol docs at docs/pulse-ipc-protocol.md.
- [2026-02-07 21:49] 2026-02-07: Extended aoc-hub-rs with Pulse UDS service at /run/user/<uid>/aoc/<session_slug>/pulse.sock, including handshake-scoped snapshot+delta state store, bounded subscriber fanout with slow-consumer disconnect, heartbeat stale eviction, and a 250ms zellij dump-layout watcher that prunes closed-pane agents immediately with jitter/error/backoff logging.
- [2026-02-07 21:52] 2026-02-07: Refactored aoc-agent-wrap-rs telemetry tap to capture bounded PTY output ring buffer (64KiB) and moved lifecycle parsing to a 250ms debounced reporter loop with content-hash gating + hysteresis; reporter now emits status states (running/busy/needs-input/error/idle) from off-hot-path heuristics.
- [2026-02-07 22:07] 2026-02-07: Pulse UDS hub command routing now enforces subscriber role + session-scoped targets, sends soft accepted/error command_result acks, supports hub-side focus_tab actions, and deduplicates repeated request_id commands per subscriber; wrapper Ctrl-C handling now escalates SIGINT->SIGTERM->SIGKILL with timeout.
- [2026-02-07 22:33] 2026-02-07: Integrated aoc-mission-control with Pulse UDS NDJSON transport (hello+subscribe, snapshot/delta/heartbeat ingest, reconnect with cache reset on disconnect), switched overview focus/stop actions to hub command channel with command_result handling for focus_tab and stop_agent, and added attention-priority overview sorting while preserving local fallback for work/diff/health when hub data is unavailable.
- [2026-02-07 22:51] 2026-02-07: Task 69 pulse-vNext rollout guardrails added: AOC_PULSE_VNEXT_ENABLED gates Pulse UDS in aoc-hub-rs and Pulse subscriber mode in aoc-mission-control for immediate rollback to websocket+local fallback. Added structured observability events for pulse_end_to_end_latency (hub ingest/render), pulse_queue_drop/pulse_send_backpressure counters, pulse_layout_watcher_health, and wrapper pulse_parser_confidence_transition. Added ignored stress benchmark pulse_stress_agents_tab_churn_benchmark covering 5/10/20 agents with tab churn and latency/state-budget assertions.
- [2026-02-07 22:56] 2026-02-07: Canary smoke validated Pulse vNext rollback flag behavior in hub binary. With AOC_PULSE_VNEXT_ENABLED=0 hub logs pulse_rollout_disabled and starts without pulse_uds_start; with flag=1 hub logs pulse_uds_start on configured socket. Mission-control tests also pass with flag disabled.
- [2026-02-07 23:28] 2026-02-07: aoc-mission-control now performs typed Pulse source parsing for task_summaries/diff_summary/health from AgentState.source, updates hub caches on snapshot/delta upserts, and treats Health mode as hub-driven when Pulse health payloads are present while preserving local fallback.
- [2026-02-07 23:54] 2026-02-07: aoc-agent-wrap-rs now publishes Pulse UDS delta/heartbeat state with typed source sections (agent_status/task_summaries+task_summary/diff_summary/health), handles stop_agent command_result + SIGINT self-interrupt, and emits health snapshots from task/dependency/check probes.
- [2026-02-08 09:27] 2026-02-08: mission-control now keeps hub snapshot for a short reconnect grace window (2s), marks hub as reconnecting, and avoids injecting local-only overview rows while hub data is preferred to eliminate one-tick local fallback flicker and join/remove churn.
- [2026-02-08 09:41] 2026-02-08: mission-control local overview now drops runtime snapshots unless /proc session+pane still matches, and proc fallback requires current dump-layout pane membership; this prevents stale closed-pane OpenCode rows (t?:unknown flicker) from reappearing in Pulse Overview.
- [2026-02-08 16:48] 2026-02-08: Made Pulse launch OSS-portable across repos by adding aoc-mission-control wrapper fallbacks to installed native binaries (aoc-mission-control-native in PATH/~/.local/bin plus ~/.cargo/bin), and updated install/uninstall scripts to install/remove aoc-mission-control-native.
- [2026-02-08 17:21] 2026-02-08: Stabilized Pulse Overview against multi-pane/session jitter by gating hub local-miss pruning on >=70% hub/local identity overlap and adding mission-control layout pane_id="..." fallback parsing; this prevents hub/local flip-flop (all agents vs single t?:unknown row) when local layout snapshots are partial.
- [2026-02-08 18:55] 2026-02-08: Fixed session identity precedence across launcher/wrapper scripts to prefer ZELLIJ_SESSION_NAME over AOC_SESSION_ID, preventing stale pid-* session IDs from cascading into Pulse breakage and agent watchdog self-termination in new tabs.
- [2026-02-08 19:07] 2026-02-08: Hardened hub publisher identity normalization on websocket path to match Pulse UDS (publisher agent_id can derive from pane_id as session::pane and must be in-session), and enforced wrapped Codex startup in managed Zellij panes by forcing AOC_AGENT_RUN=1 in aoc-codex/aoc-agent-run.
- [2026-02-09 08:27] 2026-02-09: Deprecated Pulse Overview by default in mission-control because operator value was low relative to latency/noise; kept implementation behind AOC_PULSE_OVERVIEW_ENABLED=1 for later phase once push-fidelity and UX usefulness criteria are met.
- [2026-02-09 13:15] Optimized pulse/mission-control CPU by reducing default layout polling cadence, adding idle subscriber-aware hub layout polling, and slowing orphan pane watchdog checks.
- [2026-02-09 13:47] Switched Pulse to tab-scope alignment model: wrappers publish tab_scope, Mission Control highlights same-tab agents by tab_scope, and hub layout watcher is disabled by default via AOC_PULSE_LAYOUT_WATCH_ENABLED=0 to avoid background dump-layout polling.
- [2026-02-11 14:08] Completed ingestion task 8: implemented IngestionOrchestrator lifecycle for extract->parse->chunk->embed->index with validated status transitions (uploaded/processing/partial/indexed/failed), typed retryable/non-retryable stage errors, retry/backoff handling, idempotency-key replay protection, and structured per-document event logs; added failure-injection tests for happy path, retry success, partial failures, and idempotent re-entry.
- [2026-02-12 10:47] Completed engine tasks 10 and 9: added src/tools/fs_tools.py with deterministic list_sections/read_section/keyword_grep contracts (normalized section keys, bounded outputs, line/char spans, structured section_not_found/no_matches errors) and added src/engine/local_llm.py with retrieval-grounded LocalQAEngine (prompt versioning, insufficient-evidence fallback, trace latency/retrieved chunk IDs, Ollama HTTP adapter, hashing query embedder); added tests/test_fs_tools.py and tests/test_local_llm.py; full pytest now passes (42/42).
- [2026-02-12 11:06] Completed engine task 12 by adding src/engine/extractor.py with Tier4StructuredExtractor (LangExtract adapter protocol/runtime client, strict schema validation, per-field character-level provenance offsets/text checks, unsupported-claim rejection, normalized success/error envelopes with diagnostics, and preflight/output token budget guards). Exported extractor interfaces in src/engine/__init__.py and added tests/test_extractor.py covering valid grounded payloads, invalid/missing provenance with required-field rejection, and input budget fail-fast behavior. Full pytest passes (48/48).
- [2026-02-12 11:49] Completed api-ui task 14 by adding Streamlit frontend in frontend/app.py with mode toggle, ingest wiring, session-state chat history, and trace/citation expanders. Added frontend API client/state helpers plus tests/test_frontend_client.py and tests/test_frontend_state.py; pytest passing (63).
- [2026-02-12 12:16] 2026-02-12: Restored humorous session naming fallback by replacing pid-based fallback with unique noun-verb generation across launch/new-tab/wrapper/hub scripts while preserving early session-id derivation for hub routing.
- [2026-02-13 11:05] 2026-02-13: Optimized aoc-ops for layout operations; template now instructs creating/validating .aoc/layouts layouts and preferring project layouts, and aoc-init now backfills this layout guidance into existing .opencode/agents/aoc-ops.md files when missing.
- [2026-02-13 11:28] 2026-02-13: Hardened launch-time cleanup to prevent fresh agent exits: aoc-launch/aoc-new-tab now run cleanup with startup delay and guarded env defaults (sessions=current, require active pane signals, skip when no sessions, minimum process age filter). aoc-cleanup now supports AOC_CLEANUP_REQUIRE_ACTIVE_SIGNALS, AOC_CLEANUP_SKIP_IF_NO_SESSIONS, and AOC_CLEANUP_MIN_PROCESS_AGE_SECS.
- [2026-02-13 12:16] 2026-02-13: Hardened auto cleanup safety. Non-strict mode now skips pane-miss candidates instead of killing immediately; strict pane mode retains hard pane-miss kills. Launch/new-tab cleanup now sets AOC_CLEANUP_PANE_STRICT=0, uses a 300s startup min-age default, and uses a non-blocking flock lock to prevent overlapping cleanup races.
- [2026-02-13 13:42] UI parity decision: expose structured extraction and observability directly in Streamlit (not API-only). Compose defaults now bias to local full-feature profile (DEEP_MODE_ENABLED=true, CLOUD_AGENT_PROVIDER=local) so deep mode works out-of-box without cloud credentials.
- [2026-02-14 08:55] 2026-02-14: Extended aoc-theme with interactive TUI selector and curated preset catalog (catppuccin, dracula, everforest, gruvbox, kanagawa, monokai, nord, onedark, rose-pine, solarized-dark/light, tokyo-night). TUI separates preset and custom (project/global) themes and supports live apply/default actions.
- [2026-02-14 09:29] 2026-02-14: Unified AOC theme propagation implemented. aoc-theme now syncs a shared theme profile (~/.config/aoc/theme.env), regenerates Yazi theme (~/.config/yazi/theme.toml), and AOC launch/new-tab now auto-sync theme + inject palette placeholders into layouts so zjstatus and pane environment align with selected Zellij theme. Pulse now consumes AOC_THEME_* palette env for custom colors.
- [2026-02-15 04:51] 2026-02-15: Deprecated per-project aoc-theme scope; aoc-theme now treats Zellij themes as global-only. --scope auto/all map to global with warnings for compatibility, while --scope project now errors. TUI remains interactive with preset/custom global sections and launchers now sync without scope flags.
- [2026-02-15 17:13] 2026-02-15: Fixed CI workflow to target Rust workspace at crates/Cargo.toml (including rust-cache workspace path and bash-invoked lint step). Hardened installer smoke against GitHub API rate limits by forwarding GITHUB_TOKEN into docker/sudo env and adding authenticated/retry-aware release tag resolution in install.sh with redirect fallback.
- [2026-02-15 17:23] Decision: persist parsed markdown artifacts at ingest parse time to data/parsed/<document_id>.md across parser routes (docling/google/fallback), and make deep-mode tool bootstrap failures deterministic (no 500) with parsed_artifact_missing/tooling_unavailable termination reasons.
- [2026-02-17 15:12] 2026-02-17: switched local inference default model to hadad/LFM2.5-1.2B:Q8_0 (non-thinking instruct) in settings and compose/dev env, and pulled model into Ollama container for local runtime.
- [2026-02-21 12:45] Telemetry policy: redact secret-like substrings (key-value credentials, authorization headers, bearer tokens, common token signatures) from agent tap/status snippets before publishing to hub or Pulse; allow extension via AOC_TELEMETRY_REDACT_KEYS.
- [2026-02-21 13:02] [2026-02-21] RTK integration baseline: project-local .aoc/rtk.toml policy (mode/fail_open/allowlist/denylist/install contract), session-local shim routing in aoc-agent-wrap, fail-open proxy fallback, and Alt+C control actions via aoc-rtk.
- [2026-02-22 16:30] OmO integration strategy approved: sandbox-first profile isolation, AOC remains context authority (.aoc), Taskmaster remains sole task authority, and OmO loop-heavy/autonomous features are disabled by default for control-first operation. Track execution under tag 'omo' tasks 91-99 with PRD .taskmaster/docs/prds/omo-integration_prd_rpg.md.
- [2026-02-22 17:14] RTK routing stability guard: aoc-rtk-proxy now uses built-in cache reads (no shimmed cat), short status cache TTL (default 5s), and lock-based status refresh to prevent recursive/thundering-herd status --shell calls that can spike CPU.
- [2026-02-23 11:37] 2026-02-23: Mind planning updated with T0 pre-distillation compaction strategy. Raw events remain authoritative; T0 compact lane keeps user/assistant/system text, strips bulky tool output by default, retains one-line tool metadata, supports policy-versioned allowlisted snippets, enforces one-conversation T1 passes (target 28k/hard 32k), and keeps Zen as optional background T2 enhancer with strict fail-open fallback.
- [2026-02-23 12:08] Mind contract decision: T1 remains conversation-scoped (no cross-conversation mixing). T2 may aggregate across T1 observations within a single active tag/workstream to preserve project-level continuity, with deterministic ordering and provenance.
- [2026-02-23 15:34] Task 108 provider scope set to Zen-only semantic Observer/Reflector for now; Roam and Ouros deferred. Model selection will be runtime-configurable with low-cost default profile (e.g., Minimax M2.5).
- [2026-02-23 15:48] Adopted public-core/private-overlay architecture for enterprise client work (Obventum): private client projects in src/projects-private, private client brand in src/clients-private, private assets in static-private, renders in out, while preserving OSS-safe shared engine.
- [2026-02-23 15:52] Task 108 now has task-level PRD override documenting Zen-based semantic OM background layer (Observer/Reflector) with deterministic fallback and provider guardrails; Roam/Ouros deferred.
- [2026-02-23 16:05] Implemented public registry + gitignored runtime registry split: src/projects/index.ts stays public-only while .moremotion/projects.runtime.ts is generated for local private overlays and consumed via @projects-runtime alias.
- [2026-02-25 07:55] Initiated cross-repo WorkOS-only migration planning. Created Taskmaster tags and linked RPG PRDs for program + intrface-auth + voyager + audio-os/midiflow + Funda + agropulse + cividesk; seeded initial migration task sets.
- [2026-02-25 15:59] PI-first ownership contract approved (task 121): .aoc remains control plane; .pi is canonical runtime surface for settings/prompts/skills/extensions; compatibility window spans tasks 122-126 and closes in task 128 with non-destructive migration + rollback criteria.
- [2026-02-25 16:03] aoc-init now enforces deterministic PI baseline: creates .pi/{prompts,skills,extensions}, seeds required prompts via allowlist (aoc-ops, teach*, tm-cc), no tmcc prompt seeding, and always syncs PI skills target for baseline convergence.
- [2026-02-25 16:13] Prompt canonicalization complete (task 123): aoc-init now resolves required PI prompts via canonical sources first (.config/aoc/pi/prompts, bundled .pi/prompts) with explicit legacy fallback (.aoc/prompts/pi) during compatibility window; runtime ownership remains .pi/prompts; tmcc alias remains non-canonical and is not seeded.
- [2026-02-25 16:14] AOC Mind semantic runtime strategy updated: PI-native per-session T1 observer sidecars + singleton detached T2 reflector with lock/lease coordination; deterministic distillation remains fail-open baseline; specialist roles are active human-in-command dispatch (Scout/Planner/Builder/Reviewer/Documenter/Red Team), not autonomous swarms.
- [2026-02-25 16:22] Skill canonicalization complete (task 124): .pi/skills is now the PI-first canonical skill source; aoc-skill resolves source as .pi/skills first with .aoc/skills compatibility fallback, skips self-sync for PI target, and aoc-init seeds .pi/skills from canonical templates (legacy fallback allowed during compatibility window).
- [2026-02-25 16:39] PI-first cleanup tasks 125-128 complete: aoc-init no longer auto-syncs non-PI skill targets, migrates missing legacy .aoc/prompts/pi and .aoc/skills assets into .pi non-destructively, cleans safe tmcc prompt alias duplicates, and includes scripts/pi/test-aoc-init-pi-first.sh smoke validation.
- [2026-02-25 17:02] PI-only runtime policy adopted: AOC agent surface now supports only pi and pi-r; legacy non-PI launcher/install paths are blocked with explicit migration guidance.
- [2026-02-26 08:05] Task 131 implementation: introduced shared mind_observer pulse contract (aoc-core), mission-control Mind mode with tab-scoped observer timeline + manual run shortcut, and agent-wrap propagation for run_observer command + task-complete queued feed events via source.mind_observer.
- [2026-02-26 09:15] Implemented session-branch observer backfill: added conversation_lineage schema (v4) populated from raw event session/parent/root metadata, session tree query + stale-conversation detector in aoc-storage, and aoc-mind sidecar auto-enqueues stale sibling/branch conversations after each run so branch trees become part of project mind.
- [2026-02-26 09:44] Added strict conversation lineage contract for branch graphing: canonical mind_lineage attrs (session_id,parent_conversation_id,root_conversation_id), validation at storage ingest rejects partial branch metadata, and sidecar backfill now scopes by root_conversation_id tree instead of whole session when lineage exists.
- [2026-02-26 09:49] Created RPG PRD for AOC Mind graph foundation at .taskmaster/docs/prds/aoc-mind-graph-foundation_prd_rpg.md and linked it as task-level PRD for new mind task 132 (branch-aware graph payload/export + mission-control adapter contract).
- [2026-02-26 10:02] Funda WorkOS authn scaffolding implemented behind AUTH_PROVIDER_MODE=workos: dual-provider middleware dispatch, WorkOS callback/sign-in/sign-up/sign-out routes, localized sign-in/up WorkOS redirects, WorkOS webhook verification scaffold, and Convex auth provider mode support. Added @workos-inc/authkit-nextjs + @workos-inc/node deps and updated lockfile. Kept @intrface/auth pinned to 0.0.2 until 0.0.3 publish.
- [2026-02-26 10:54] 2026-02-26: Added live theme preview behavior in aoc-control (j/k preview, Enter selects fallback, Esc restores selected fallback) and optimized Alt+c launcher by removing bash -lc shell hop. aoc-theme now generates/syncs Pi theme (~/.pi/agent/themes/aoc-live.json) and updates Pi settings theme for cross-surface live palette alignment.
- [2026-02-26 11:09] Configured intrface-auth for GitHub Packages publishing: publishConfig registry set to npm.pkg.github.com, scope registry configured in intrface-auth/.npmrc, and README updated with npm token + whoami + publish workflow. Publish still pending authenticated PAT and package-scope owner alignment for @intrface.
- [2026-02-26 11:17] 2026-02-26: Fixed Theme Manager freeze risk by changing preview apply path to run aoc-theme with inherited tty (AOC_THEME_QUIET=1) and removing immediate preview apply when opening Presets/Customs; preview now starts on navigation.
- [2026-02-26 11:23] intrface-auth GitHub Packages org alignment: switched package scope to @intrface-eu/auth for intrface-eu organization, updated .npmrc and docs, and validated pack artifact intrface-eu-auth-0.0.3.tgz. Publish pending PAT-based authentication.
- [2026-02-26 15:47] 2026-02-26: Fixed Control theme-preview exit stall by skipping restore apply when no live preview was actually applied. Hardened aoc-control-toggle duplicate detection to identify existing control panes by command (aoc-control*) in dump-layout, not just pane name, preventing stacked duplicate floating Control panes.
- [2026-02-26 15:53] 2026-02-26: Root cause of Control Theme Manager freeze identified: aoc-control runs terminal in raw mode, and invoking 'aoc-theme apply' (which runs 'zellij options --theme') from raw mode can hang indefinitely. Fixed by temporarily disabling raw mode around theme apply/interactive theme command execution, then restoring raw mode.
- [2026-02-26 16:15] 2026-02-26: Zellij has no 'action set-theme' endpoint in 0.43.1; runtime theme changes go through 'zellij options --theme'. Hardened aoc-control preview apply: enforce cooked mode around theme commands + 1200ms timeout/kill around quiet apply to prevent Theme Manager hangs.
- [2026-02-26 16:16] 2026-02-26: For live preview reliability, restored fully-attached stdio path for  (no stdout/stderr redirection in aoc-theme apply, no null stdio in aoc-control preview spawn). Added cooked-mode guard + 2.5s timeout kill around preview apply to avoid pane deadlocks.
- [2026-02-26 16:16] 2026-02-26: Restored attached stdio for zellij theme apply path and added cooked-mode+timeout safeguards in aoc-control preview execution to prevent hangs.
