#!/usr/bin/env bash
set -euo pipefail

STATE_DIR="${XDG_STATE_HOME:-$HOME/.local/state}/aoc"
PREVIEW_PATH_FILE="${AOC_PREVIEW_PATH_FILE:-$STATE_DIR/preview_path}"

path="${1:-}"
if [[ -z "$path" && -n "${YAZI_FILE:-}" ]]; then
  path="$YAZI_FILE"
fi

if [[ -z "$path" ]]; then
  echo "Usage: aoc-preview-set /path/to/file" >&2
  exit 1
fi

if [[ ! -e "$path" ]]; then
  echo "Path not found: $path" >&2
  exit 1
fi

mkdir -p "$STATE_DIR"
path="$(realpath "$path")"
echo "$path" > "$PREVIEW_PATH_FILE"
echo "Preview target set: $path"
