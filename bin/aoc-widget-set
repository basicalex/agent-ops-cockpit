#!/usr/bin/env bash
set -euo pipefail

STATE_DIR="${XDG_STATE_HOME:-$HOME/.local/state}/aoc"
ASSET="${STATE_DIR}/widget_asset"
MODE_FILE="${STATE_DIR}/widget_mode"

path="${1:-}"
if [[ -z "$path" && -n "${YAZI_FILE:-}" ]]; then
  path="$YAZI_FILE"
fi

if [[ -z "$path" ]]; then
  echo "Usage: aoc-widget-set /path/to/media" >&2
  exit 1
fi

if [[ ! -e "$path" ]]; then
  echo "Path not found: $path" >&2
  exit 1
fi

mkdir -p "$STATE_DIR"
path="$(realpath "$path")"
echo "$path" > "$ASSET"
echo "media" > "$MODE_FILE"
echo "Widget media set: $path"
