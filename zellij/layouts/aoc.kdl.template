layout {
  tab name="__AOC_TAB_NAME__" focus=true {
    pane split_direction="horizontal" {
      pane size=1 borderless=true {
        plugin location="file:{{HOME}}/.config/zellij/plugins/zjstatus.wasm" {
          format_left   "{mode} #[fg=blue,bold]{session}"
          format_center "{tabs}"
          format_right  "{command_cwd}"
          format_space  ""

          border_enabled  "false"
          border_char     "─"
          border_format   "#[fg=black]{char}"
          border_position "bottom"

          hide_frame_for_single_pane "true"

          mode_normal  "#[bg=blue] "
          mode_tmux    "#[bg=orange] "

          tab_normal   "#[fg=black] {name} "
          tab_active   "#[fg=white,bold,italic] {name} "

          command_cwd_command  "pwd | sed 's|.*/||'"
          command_cwd_format   "#[fg=black] {stdout} "
          command_cwd_interval "2"
        }
      }
      pane split_direction="vertical" {
        // LEFT: Yazi (tree + preview). Starts in project root.
        pane size="13%" name="Explorer" command="bash" {
          args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export EDITOR=micro; export VISUAL=$EDITOR; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_FILETREE_CMD:-yazi} ."
        }

        // CENTER + RIGHT COLUMN
        pane split_direction="vertical" {

          // CENTER stack: Agent (top) + Taskmaster (bottom)
          pane split_direction="horizontal" stacked=true {
            pane name="Agent [__AOC_AGENT_ID__]" expanded=true focus=true command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; export AOC_PANE_ID=\"${ZELLIJ_PANE_ID:-}\"; cd \"__AOC_PROJECT_ROOT__\" && AOC_AGENT_RUN=1 exec ${AOC_AGENT_CMD:-${AOC_CODEX_CMD:-aoc-agent-run}}"
            }

            pane command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; export AOC_TASKMASTER_NATIVE=1; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_TASKMASTER_CMD:-aoc-taskmaster}"
            }
          }

          // RIGHT COLUMN: AOC Pulse (top), Terminal (bottom)
          pane size="23%" split_direction="horizontal" {
            pane size="52%" name="AOC Pulse" command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; export AOC_PANE_ID=\"${ZELLIJ_PANE_ID:-}\"; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_PULSE_CMD:-aoc-mission-control}"
            }
            pane size="48%" command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_TERMINAL_CMD:-$SHELL}"
            }
          }
        }
      }
      pane size=1 borderless=true {
        plugin location="file:{{HOME}}/.config/zellij/plugins/zjstatus.wasm" {
          format_left   "{mode}"
          format_center ""
          format_right  "{command_alt}"
          format_space  ""

          border_enabled  "false"
          border_char     "─"
          border_format   "#[fg=black]{char}"
          border_position "top"

          hide_frame_for_single_pane "true"

          mode_normal "#[fg=blue,bold]NORMAL #[fg=black]| #[fg=green]Ctrl #[fg=black]g Lock  p Pane  t Tab  n Resize  s Scroll  h Move  o Session  b Tmux"
          mode_locked "#[fg=red,bold]LOCKED #[fg=black]| #[fg=green]Ctrl #[fg=black]g Unlock"
          mode_resize "#[fg=orange,bold]RESIZE #[fg=black]| #[fg=green]h/j/k/l #[fg=black]Resize #[fg=green]H/J/K/L #[fg=black]Fine #[fg=green]+/- #[fg=black]Resize #[fg=green]Ctrl #[fg=black]n Normal"
          mode_pane "#[fg=green,bold]PANE #[fg=black]| #[fg=green]h/j/k/l #[fg=black]Move #[fg=green]n #[fg=black]New #[fg=green]d #[fg=black]Down #[fg=green]r #[fg=black]Right #[fg=green]x #[fg=black]Close #[fg=green]f #[fg=black]Fullscreen #[fg=green]w #[fg=black]Float #[fg=green]Ctrl #[fg=black]p Normal"
          mode_tab "#[fg=cyan,bold]TAB #[fg=black]| #[fg=green]h/l #[fg=black]Prev/Next #[fg=green]n #[fg=black]New #[fg=green]x #[fg=black]Close #[fg=green]r #[fg=black]Rename #[fg=green]1-9 #[fg=black]Go #[fg=green]Ctrl #[fg=black]t Normal"
          mode_scroll "#[fg=yellow,bold]SCROLL #[fg=black]| #[fg=green]j/k #[fg=black]Scroll #[fg=green]Ctrl #[fg=black]f/b Page  c Bottom  s Normal #[fg=green]d/u #[fg=black]Half #[fg=green]s #[fg=black]Search #[fg=green]e #[fg=black]Edit"
          mode_enter_search "#[fg=yellow,bold]SEARCH #[fg=black]| #[fg=green]Enter #[fg=black]Find #[fg=green]Esc/Ctrl #[fg=black]c Back"
          mode_search "#[fg=yellow,bold]SEARCH #[fg=black]| #[fg=green]n/p #[fg=black]Next/Prev #[fg=green]c #[fg=black]Case #[fg=green]w #[fg=black]Wrap #[fg=green]o #[fg=black]Word #[fg=green]Ctrl #[fg=black]c Normal"
          mode_rename_tab "#[fg=magenta,bold]RENAME TAB #[fg=black]| #[fg=green]Enter #[fg=black]Save #[fg=green]Esc #[fg=black]Cancel"
          mode_rename_pane "#[fg=magenta,bold]RENAME PANE #[fg=black]| #[fg=green]Enter #[fg=black]Save #[fg=green]Esc #[fg=black]Cancel"
          mode_session "#[fg=blue,bold]SESSION #[fg=black]| #[fg=green]w #[fg=black]Manager #[fg=green]c #[fg=black]Config #[fg=green]p #[fg=black]Plugins #[fg=green]d #[fg=black]Detach #[fg=green]Ctrl #[fg=black]o Normal"
          mode_move "#[fg=blue,bold]MOVE #[fg=black]| #[fg=green]h/j/k/l #[fg=black]Move #[fg=green]n/Tab #[fg=black]Next #[fg=green]p #[fg=black]Prev #[fg=green]Ctrl #[fg=black]h Normal"
          mode_tmux "#[fg=red,bold]TMUX #[fg=black]| #[fg=green]Ctrl #[fg=black]b Prefix  % Split R  \" Split D  z Fullscreen  c New Tab  p/n Prev/Next  b Normal"

          command_alt_command  "printf 'Alt f Float  n NewPane  i Tab<  o Tab>  u/p MoveTab  [ Group  h/j/k/l Focus  =/- Resize'"
          command_alt_format   "#[fg=green]{stdout} "
          command_alt_interval "60"
        }
      }
    }
  }
}
swap_layouts {
  layout {
    tab name="__AOC_TAB_NAME__" focus=true {
      pane split_direction="vertical" {
        // LEFT: Yazi (tree + preview). Starts in project root.
        pane size="10%" name="Explorer" command="bash" {
          args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export EDITOR=micro; export VISUAL=$EDITOR; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_FILETREE_CMD:-yazi} ."
        }

        // CENTER + RIGHT COLUMN
        pane split_direction="vertical" {

          // CENTER stack: Agent (top) + Taskmaster (bottom)
          pane split_direction="horizontal" stacked=true {
            pane name="Agent [__AOC_AGENT_ID__]" expanded=true focus=true command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; export AOC_PANE_ID=\"${ZELLIJ_PANE_ID:-}\"; cd \"__AOC_PROJECT_ROOT__\" && AOC_AGENT_RUN=1 exec ${AOC_AGENT_CMD:-${AOC_CODEX_CMD:-aoc-agent-run}}"
            }

            pane command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; export AOC_TASKMASTER_NATIVE=1; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_TASKMASTER_CMD:-aoc-taskmaster}"
            }
          }

          // RIGHT COLUMN: AOC Pulse (top), Terminal (bottom)
          pane size="26%" split_direction="horizontal" {
            pane size="52%" name="AOC Pulse" command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; export AOC_PANE_ID=\"${ZELLIJ_PANE_ID:-}\"; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_PULSE_CMD:-aoc-mission-control}"
            }
            pane size="48%" command="bash" {
              args "-lc" "export PATH=\"$HOME/.cargo/bin:$PATH\"; theme_env=\"${XDG_CONFIG_HOME:-$HOME/.config}/aoc/theme.env\"; if [[ -f \"$theme_env\" ]]; then source \"$theme_env\"; fi; export AOC_SESSION_ID=\"__AOC_SESSION_ID__\"; export AOC_HUB_ADDR=\"__AOC_HUB_ADDR__\"; export AOC_HUB_URL=\"__AOC_HUB_URL__\"; export AOC_PROJECT_ROOT=\"__AOC_PROJECT_ROOT__\"; export AOC_TAB_SCOPE=\"__AOC_TAB_NAME__\"; cd \"__AOC_PROJECT_ROOT__\" && exec ${AOC_TERMINAL_CMD:-$SHELL}"
            }
          }
        }
      }
    }
  }
}
